{"version":3,"sources":["App.tsx","reportWebVitals.ts","index.tsx"],"names":["mediaDevices","navigator","getDevices","a","enumerateDevices","devices","vDevices","aDevices","console","log","forEach","device","kind","deviceId","label","push","getStream","audioDeviceId","videoDeviceId","getUserMedia","video","audio","stream","App","useState","peer","setPeer","join","setJoin","room","setRoom","videoDevices","setVideoDevices","audioDevices","setAudioDevices","setVideoDeviceId","setAudioDeviceId","localStream","setLocalStream","remoteStreams","setRemoteStreams","enabledAudio","setEnabledAudio","enabledVideo","setEnabledVideo","localVideoRef","useRef","refreshDevices","useCallback","retry","audios","filter","videos","length","setTimeout","useEffect","p","Peer","key","debug","on","id","current","srcObject","play","replaceStream","open","r","joinRoom","prev","toggleAudio","getAudioTracks","enabled","toggleVideo","getVideoTracks","className","htmlFor","value","onChange","e","currentTarget","map","onClick","_","ref","width","autoPlay","muted","playsInline","reportWebVitals","onPerfEntry","Function","then","getCLS","getFID","getFCP","getLCP","getTTFB","ReactDOM","render","StrictMode","document","getElementById"],"mappings":"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","file":"static/js/main.7629b7c7.chunk.js","sourcesContent":["import React, {\n  useState,\n  useEffect,\n  useCallback,\n  useRef,\n} from 'react';\nimport Peer, { MeshRoom } from 'skyway-js';\nimport './App.css';\n\nconst mediaDevices = navigator.mediaDevices;\nasync function getDevices() {\n  const devices = await mediaDevices.enumerateDevices();\n  const vDevices: MediaDeviceInfo[] = [];\n  const aDevices: MediaDeviceInfo[] = [];\n  console.log(devices);\n  devices.forEach((device) => {\n    const { kind, deviceId, label } = device;\n    switch (kind) {\n      case \"audioinput\":\n        aDevices.push(device);\n        break;\n      case \"videoinput\":\n        vDevices.push(device);\n        break;\n    }\n  });\n  return {\n    vDevices, aDevices\n  };\n}\n\nasync function getStream({\n  audioDeviceId,\n  videoDeviceId\n}: { audioDeviceId: string, videoDeviceId: string }) {\n  const stream = await mediaDevices.getUserMedia({\n    video: {\n      deviceId: videoDeviceId\n    },\n    audio: {\n      deviceId: audioDeviceId\n    }\n  });\n\n  return stream;\n}\n\nfunction App() {\n  const [peer, setPeer] = useState<Peer | null>(null);\n  const [join, setJoin] = useState(false);\n  const [room, setRoom] = useState<MeshRoom | null>(null);\n\n  const [videoDevices, setVideoDevices] = useState<MediaDeviceInfo[]>([]);\n  const [audioDevices, setAudioDevices] = useState<MediaDeviceInfo[]>([]);\n  const [videoDeviceId, setVideoDeviceId] = useState<string>('');\n  const [audioDeviceId, setAudioDeviceId] = useState<string>('');\n\n  const [localStream, setLocalStream] = useState<MediaStream | null>(null);\n  const [remoteStreams, setRemoteStreams] = useState<MediaStream[]>([]);\n\n  const [enabledAudio, setEnabledAudio] = useState(true);\n  const [enabledVideo, setEnabledVideo] = useState(true);\n\n  const localVideoRef = useRef(null);\n\n  const refreshDevices = useCallback(async (retry = 0) => {\n    console.log('called refreshDevices');\n    const {\n      aDevices,\n      vDevices,\n    } = await getDevices();\n\n    const audios = aDevices.filter(({ label }) => label !== '');\n    const videos = vDevices.filter(({ label }) => label !== '');\n\n    setAudioDevices(() => audios);\n    setVideoDevices(() => videos);\n\n    console.log({\n      audios,\n      videos\n    });\n\n    if (audios.length === 0 && videos.length === 0 && retry < 10) {\n      setTimeout(() => refreshDevices(retry + 1), 3000);\n    }\n  }, []);\n\n  useEffect(() => {\n    (async () => {\n      const p = new Peer({\n        key: 'bfae4862-4740-46d1-bf51-8ee9105b83f3',\n        debug: 3\n      });\n      p.on('open', () => {\n        console.log(p.id);\n      });\n      setPeer(() => p);\n      await refreshDevices();\n    })();\n  }, []);\n\n  useEffect(() => {\n    (async () => {\n      const stream = await getStream({\n        audioDeviceId,\n        videoDeviceId,\n      });\n      setLocalStream(stream);\n      if (stream && localVideoRef && localVideoRef.current) {\n        const video: HTMLVideoElement = localVideoRef.current;\n        video.srcObject = stream;\n        video.play();\n      }\n\n      if (room) {\n        room.replaceStream(stream);\n      }\n    })();\n  }, [audioDeviceId, videoDeviceId]);\n\n  useEffect(() => {\n    (async () => {\n      if (!join) return;\n      if (!localStream) return;\n      if (!peer || peer && !peer.open) return;\n      const r: MeshRoom = peer.joinRoom('test-room-id', {\n        stream: localStream\n      });\n      r.on('stream', async (stream) => {\n        setRemoteStreams((prev) => [\n          ...prev,\n          stream\n        ]);\n      });\n      setRoom(() => r);\n      console.log(r);\n    })();\n  }, [join]);\n\n  const toggleAudio = useCallback(() => {\n    const audios = localStream && localStream.getAudioTracks();\n    if (audios) {\n      const [audio] = audios;\n      audio.enabled = !enabledAudio;\n      setEnabledAudio(!enabledAudio);\n    }\n  }, [localStream, enabledAudio]);\n\n  const toggleVideo = useCallback(() => {\n    const videos = localStream && localStream.getVideoTracks();\n    if (videos) {\n      const [video] = videos;\n      video.enabled = !enabledVideo;\n      setEnabledVideo(!enabledVideo);\n    }\n  }, [localStream, enabledVideo]);\n\n  return (\n    <div className=\"App\">\n      <div>\n        <label htmlFor=\"audio-devices\">\n          AudioDevice: \n        </label>\n        <select\n          id=\"audio-devices\"\n          value={audioDeviceId}\n          onChange={e => setAudioDeviceId(e.currentTarget.value)}\n        >\n          {audioDevices.map(({ deviceId, label }) => (\n            <option key={deviceId} value={deviceId}>\n              {label}\n            </option>\n          ))}\n        </select>\n      </div>\n      <div>\n        <label htmlFor=\"video-devices\">\n          VideoDevice: \n        </label>\n        <select\n          id=\"video-devices\"\n          value={videoDeviceId}\n          onChange={e => setVideoDeviceId(e.currentTarget.value)}\n        >\n          {videoDevices.map(({ deviceId, label }) => (\n            <option key={deviceId} value={deviceId}>\n              {label}\n            </option>\n          ))}\n        </select>\n      </div>\n      <div>\n        <button onClick={_=>setJoin(true)}>Join</button>\n      </div>\n      <div>\n        <button onClick={_=>toggleVideo()}>{enabledVideo ? 'カメラを無効にする' : 'カメラを有効にする'}</button>\n        <button onClick={_=>toggleAudio()}>{enabledAudio ? 'ミュートする' : 'ミュート解除'}</button>\n      </div>\n      <video\n        ref={localVideoRef}\n        width=\"400px\"\n        autoPlay\n        muted\n        playsInline\n      />\n      <div>\n        {remoteStreams.map((stream) => (\n          <video\n            autoPlay\n            playsInline\n            ref={(video) => { if (video) video.srcObject = stream }}\n          />\n        ))}\n      </div>\n    </div>\n  );\n}\n\nexport default App;\n","import { ReportHandler } from 'web-vitals';\n\nconst reportWebVitals = (onPerfEntry?: ReportHandler) => {\n  if (onPerfEntry && onPerfEntry instanceof Function) {\n    import('web-vitals').then(({ getCLS, getFID, getFCP, getLCP, getTTFB }) => {\n      getCLS(onPerfEntry);\n      getFID(onPerfEntry);\n      getFCP(onPerfEntry);\n      getLCP(onPerfEntry);\n      getTTFB(onPerfEntry);\n    });\n  }\n};\n\nexport default reportWebVitals;\n","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport './index.css';\nimport App from './App';\nimport reportWebVitals from './reportWebVitals';\n\nReactDOM.render(\n  <React.StrictMode>\n    <App />\n  </React.StrictMode>,\n  document.getElementById('root')\n);\n\n// If you want to start measuring performance in your app, pass a function\n// to log results (for example: reportWebVitals(console.log))\n// or send to an analytics endpoint. Learn more: https://bit.ly/CRA-vitals\nreportWebVitals();\n"],"sourceRoot":""}